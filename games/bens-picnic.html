<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Ben's Picnic — Endue Learning</title>
  <link rel="stylesheet" href="/assets/css/style.css">
  <script src="/assets/js/header.js" defer></script>
  <script src="/assets/js/footer.js" defer></script>
  <style>
    .game-wrapper{max-width:1100px;margin:18px auto;padding:12px;}
    .iframe-frame{position:relative;width:100%;padding-top:56.25%;border-radius:10px;overflow:hidden;background:#000;box-shadow:0 10px 30px rgba(12,45,80,0.08);}
    .iframe-frame iframe{position:absolute;top:0;left:0;width:100%;height:100%;border:0;}
    .mobile-ctrls{position:fixed;left:12px;bottom:18px;z-index:2200;display:flex;gap:10px;align-items:center;pointer-events:none;}
    .ctrl-btn{pointer-events:auto;width:60px;height:60px;border-radius:12px;background:rgba(43,156,255,0.95);color:#fff;display:flex;align-items:center;justify-content:center;font-size:22px;font-weight:700;box-shadow:0 8px 18px rgba(11,53,85,0.18)}
    @media(min-width:880px){.mobile-ctrls{display:none!important}}
  </style>
</head>
<body>
  <div id="header"></div>

  <script>
  (function(){
    document.addEventListener('DOMContentLoaded', ()=>{
      const headerRoot = document.querySelector('header.main-header') || document.getElementById('header');
      if(!headerRoot) return;
      headerRoot.querySelectorAll('a[href]').forEach(a=>{
        const href = a.getAttribute('href')||'';
        if(!href||href.startsWith('#')||href.startsWith('http')||href.startsWith('/')) return;
        a.setAttribute('href','/' + href.replace(/^\.\//,''));
      });
      const logo = headerRoot.querySelector('.logo-link'); if(logo) logo.setAttribute('href','/index.html');
    });
  })();
  </script>

  <main class="container game-wrapper card">
    <h1>Ben's Picnic</h1>
    <p class="small">Use arrow keys on desktop; use touch buttons on mobile. Tap = single step, hold = continuous.</p>

    <div class="iframe-frame" id="gameFrameWrap">
      <iframe id="gameIframe" src="/games/ben-picnic-full.html" title="Ben's Picnic" allow="autoplay; fullscreen; encrypted-media" loading="lazy"></iframe>
    </div>

    <div style="margin-top:12px;">
      <a class="btn" href="/games/ben-picnic-full.html" target="_blank">Open full page</a>
      <span class="small" style="margin-left:10px">Tap inside the game area to enable audio & focus.</span>
    </div>
  </main>

  <div id="footer"></div>

  <div class="mobile-ctrls" id="mobileCtrls">
    <button class="ctrl-btn" data-key="ArrowLeft">◀</button>
    <button class="ctrl-btn" data-key="ArrowRight">▶</button>
    <button class="ctrl-btn" data-key="ArrowUp" style="width:46px;height:46px">▲</button>
    <button class="ctrl-btn" data-key=" " style="width:46px;height:46px">␣</button>
  </div>

  <script>
  (function(){
    const iframe = document.getElementById('gameIframe');
    const controls = document.querySelectorAll('.mobile-ctrls .ctrl-btn');
    if(!iframe) return;

    function sendKey(key,type='keydown'){
      try{
        const win = iframe.contentWindow;
        const ev = new win.KeyboardEvent(type,{key:key===' ' ? ' ' : key, code:key, bubbles:true, cancelable:true});
        (win.document.activeElement||win.document.body||win.document).dispatchEvent(ev);
        win.dispatchEvent(ev);
      }catch(e){
        try{ iframe.contentWindow.postMessage(JSON.stringify({type:'virtual-key',key,action:type}),'*'); }catch(e){}
      }
    }

    const HOLD_DELAY=200, REPEAT_INTERVAL=140;
    controls.forEach(btn=>{
      const key = btn.getAttribute('data-key');
      let holdTimer=null, holdInterval=null;
      function start(e){
        e.preventDefault();
        try{ iframe.contentWindow.focus(); }catch(e){}
        sendKey(key,'keydown');
        holdTimer = setTimeout(()=>{ holdTimer=null; holdInterval = setInterval(()=>sendKey(key,'keydown'), REPEAT_INTERVAL); }, HOLD_DELAY);
      }
      function end(e){
        e.preventDefault();
        if(holdTimer){ clearTimeout(holdTimer); holdTimer=null; sendKey(key,'keyup'); }
        else { if(holdInterval){ clearInterval(holdInterval); holdInterval=null; } sendKey(key,'keyup'); }
      }
      btn.addEventListener('pointerdown', start);
      btn.addEventListener('pointerup', end);
      btn.addEventListener('pointerleave', end);
      btn.addEventListener('touchstart', start, {passive:false});
      btn.addEventListener('touchend', end);
      btn.addEventListener('mousedown', start);
      btn.addEventListener('mouseup', end);
    });

    // show controls on fullscreen too
    function checkFS(){
      const fs = document.fullscreenElement || document.webkitFullscreenElement || document.mozFullScreenElement;
      const el = document.getElementById('mobileCtrls');
      if(fs === document.getElementById('gameIframe') || fs === document.getElementById('gameFrameWrap') || fs === document.body){ el.style.display='flex'; } else { el.style.display = /Android|iPhone|Mobile/i.test(navigator.userAgent) ? 'flex' : 'none'; }
    }
    document.addEventListener('fullscreenchange', checkFS);
    setInterval(checkFS, 300);
    checkFS();
  })();
  </script>
</body>
</html>
